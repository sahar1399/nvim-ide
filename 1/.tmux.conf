# ( vim: set ts=4 sw=4 et fdm=marker: )

# screen saver
set -g lock-after-time 300
set -g lock-command "cmatrix -forbsa"
# set -g monitor-silence 5
# set -g visual-silence off
# set -g alert-silence clock
# set -g silence-action current
# set -g visual-bell off
# end screen saver

set -g prefix C-b

set-option -g default-shell /bin/zsh
# set -g default-terminal "screen-256color"
set -g default-terminal "tmux-256color"
set -g mouse on
setw -g mode-keys vi
set -sg escape-time 0
set -wg xterm-keys on
set -sg extended-keys always
set -as terminal-features 'xterm*:extkeys'
set -g allow-passthrough on
set -g focus-events on

# Set new panes to open in current directory
bind c new-window -c "#{pane_current_path}"
bind '"' split-window -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

setw pane-border-status bottom
bind T run 'zsh -c "arr=( off top bottom ) && tmux setw pane-border-status \${arr[\$(( \${arr[(I)#{pane-border-status}]} % 3 + 1 ))]}"'
bind t command-prompt -p "(rename-pane)" -I "" "set -p @mytitle '%%'"
set -g pane-border-format "#{pane_index} #{@mytitle}"

set-window-option -g automatic-rename off

bind s choose-tree -s -O name
bind O setw synchronize on \; display 'Synchronize on'
bind C-o setw synchronize off \; display 'Synchronize off'
bind C send-keys -R \; clear-history
bind Escape run 'true'
bind C-v paste-buffer
bind C-] paste-buffer
bind C-z resize-pane -Z

bind N move-window -r \; display 'Renumbered' # renumber window
bind L move-pane -h -t '.-' # stack the adjacent pane horizontally
bind H move-pane -t '.-' # stack the adjacent pane vertically

# copy mode
# bind v copy-mode
setw -g mode-keys vi
bind b list-buffers
bind p paste-buffer
bind P choose-buffer
bind ? list-keys

# word separators for automatic word selection
setw -g word-separators ' @"=()[]'
setw -ag word-separators "'"

# {{{ List of plugins
# git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
set -g @plugin 'tmux-plugins/tpm'

set -g @plugin "janoamaral/tokyo-night-tmux"

set -g @plugin 'wfxr/tmux-fzf-url'

set -g @plugin 'tmux-plugins/tmux-sensible'

set -g @plugin 'MunifTanjim/tmux-suspend'
set -g @suspend_key 'F12'

set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @resurrect-save 'S'
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-capture-pane-contents 'on'

set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'on'

set -g @plugin 'tmux-plugins/tmux-open' # for open search or file
set -g @open-S 'https://www.google.com/search?q='

set -g @plugin 'tmux-plugins/tmux-yank' # set up many yank commands
set -g @yank_selection_mouse 'clipboard' # or 'primary' or 'secondary'
set -g @yank_action 'copy-pipe-and-cancel'

set -g @plugin 'laktak/extrakto' # select word from screen
set -g @extrakto_split_size "15"
set -g @extrakto_copy_key "tab"
set -g @extrakto_insert_key "enter"

set -g @plugin 'schasse/tmux-jump' # <prefix> [j]ump
set -g @jump-key 'f'

set -g @plugin 'christoomey/vim-tmux-navigator' # using our own binding above
# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|l?n?vim?x?)(diff)?$'"
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'
tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\'  'select-pane -l'"
if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\'  'select-pane -l'"

bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R
bind-key -T copy-mode-vi 'C-\' select-pane -l
bind-key -T copy-mode-vi v send-keys -X begin-selection
unbind -T copy-mode-vi MouseDragEnd1Pane
unbind -T copy-mode MouseDragEnd1Pane
unbind -T vi-copy MouseDragEnd1Pane


set -g @plugin 'nhdaly/tmux-better-mouse-mode' # for scrolling in less
set -g @emulate-scroll-for-no-mouse-alternate-buffer on

set -g @plugin 'tmux-plugins/tmux-logging'
set -g @plugin 'tmux-plugins/tmux-cowboy'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run -b '~/.tmux/plugins/tpm/tpm'

# }}}
